(function(m){function w(a){var c=e,b=c.biDivideByRadixPower(a,this.k-1),b=c.biMultiply(b,this.mu),b=c.biDivideByRadixPower(b,this.k+1);a=c.biModuloByRadixPower(a,this.k+1);b=c.biMultiply(b,this.modulus);b=c.biModuloByRadixPower(b,this.k+1);a=c.biSubtract(a,b);a.isNeg&&(a=c.biAdd(a,this.bkplus1));for(b=0<=c.biCompare(a,this.modulus);b;)a=c.biSubtract(a,this.modulus),b=0<=c.biCompare(a,this.modulus);return a}function x(a,c){var b=e.biMultiply(a,c);return this.modulo(b)}function y(a,c){var b=new l;b.digits[0]=1;for(var d=a,f=c;;){0!=(f.digits[0]&1)&&(b=this.multiplyMod(b,d));f=e.biShiftRight(f,1);if(0==f.digits[0]&&0==e.biHighIndex(f))break;d=this.multiplyMod(d,d)}return b}if("undefined"===typeof m.RSAUtils)var e=m.RSAUtils={};var r,n,q,p,l=m.BigInt=function(a){this.digits="boolean"==typeof a&&1==a?null:n.slice(0);this.isNeg=!1};e.setMaxDigits=function(a){r=a;n=Array(r);for(a=0;a<n.length;a++)n[a]=0;q=new l;p=new l;p.digits[0]=1};e.setMaxDigits(20);e.biFromNumber=function(a){var c=new l;c.isNeg=0>a;a=Math.abs(a);for(var b=0;0<a;)c.digits[b++]=a&65535,a=Math.floor(a/65536);return c};var z=e.biFromNumber(1E15);e.biFromDecimal=function(a){for(var c="-"==a.charAt(0),b=c?1:0,d;b<a.length&&"0"==a.charAt(b);)++b;if(b==a.length)d=new l;else{var f=(a.length-b)%15;0==f&&(f=15);d=e.biFromNumber(Number(a.substr(b,f)));for(b+=f;b<a.length;)d=e.biAdd(e.biMultiply(d,z),e.biFromNumber(Number(a.substr(b,15)))),b+=15;d.isNeg=c}return d};e.biCopy=function(a){var c=new l(!0);c.digits=a.digits.slice(0);c.isNeg=a.isNeg;return c};e.reverseStr=function(a){for(var c="",b=a.length-1;-1<b;--b)c+=a.charAt(b);return c};var t="0123456789abcdefghijklmnopqrstuvwxyz".split("");e.biToString=function(a,c){var b=new l;b.digits[0]=c;for(var d=e.biDivideModulo(a,b),f=t[d[1].digits[0]];1==e.biCompare(d[0],q);)d=e.biDivideModulo(d[0],b),digit=d[1].digits[0],f+=t[d[1].digits[0]];return(a.isNeg?"-":"")+e.reverseStr(f)};e.biToDecimal=function(a){var c=new l;c.digits[0]=10;for(var b=e.biDivideModulo(a,c),d=String(b[1].digits[0]);1==e.biCompare(b[0],q);)b=e.biDivideModulo(b[0],c),d+=String(b[1].digits[0]);return(a.isNeg?"-":"")+e.reverseStr(d)};var A="0123456789abcdef".split("");e.digitToHex=function(a){var c="";for(i=0;4>i;++i)c+=A[a&15],a>>>=4;return e.reverseStr(c)};e.biToHex=function(a){var c="";e.biHighIndex(a);for(var b=e.biHighIndex(a);-1<b;--b)c+=e.digitToHex(a.digits[b]);return c};e.charToHex=function(a){return 48<=a&&57>=a?a-48:65<=a&&90>=a?10+a-65:97<=a&&122>=a?10+a-97:0};e.hexToDigit=function(a){for(var c=0,b=Math.min(a.length,4),d=0;d<b;++d)c<<=4,c|=e.charToHex(a.charCodeAt(d));return c};e.biFromHex=function(a){for(var c=new l,b=a.length,d=0;0<b;b-=4,++d)c.digits[d]=e.hexToDigit(a.substr(Math.max(b-4,0),Math.min(b,4)));return c};e.biFromString=function(a,c){var b="-"==a.charAt(0),d=b?1:0,f=new l,h=new l;h.digits[0]=1;for(var g=a.length-1;g>=d;g--)var k=a.charCodeAt(g),k=e.charToHex(k),k=e.biMultiplyDigit(h,k),f=e.biAdd(f,k),h=e.biMultiplyDigit(h,c);f.isNeg=b;return f};e.biDump=function(a){return(a.isNeg?"-":"")+a.digits.join(" ")};e.biAdd=function(a,c){var b;if(a.isNeg!=c.isNeg)c.isNeg=!c.isNeg,b=e.biSubtract(a,c),c.isNeg=!c.isNeg;else{b=new l;for(var d=0,f=0;f<a.digits.length;++f)d=a.digits[f]+c.digits[f]+d,b.digits[f]=d%65536,d=Number(65536<=d);b.isNeg=a.isNeg}return b};e.biSubtract=function(a,c){var b;if(a.isNeg!=c.isNeg)c.isNeg=!c.isNeg,b=e.biAdd(a,c),c.isNeg=!c.isNeg;else{b=new l;for(var d,f=d=0;f<a.digits.length;++f)d=a.digits[f]-c.digits[f]+d,b.digits[f]=d%65536,0>b.digits[f]&&(b.digits[f]+=65536),d=0-Number(0>d);if(-1==d){for(f=d=0;f<a.digits.length;++f)d=0-b.digits[f]+d,b.digits[f]=d%65536,0>b.digits[f]&&(b.digits[f]+=65536),d=0-Number(0>d);b.isNeg=!a.isNeg}else b.isNeg=a.isNeg}return b};e.biHighIndex=function(a){for(var c=a.digits.length-1;0<c&&0==a.digits[c];)--c;return c};e.biNumBits=function(a){var c=e.biHighIndex(a);a=a.digits[c];var c=16*(c+1),b;for(b=c;b>c-16&&0==(a&32768);--b)a<<=1;return b};e.biMultiply=function(a,c){for(var b=new l,d,f=e.biHighIndex(a),h=e.biHighIndex(c),g,k=0;k<=h;++k){d=0;g=k;for(j=0;j<=f;++j,++g)d=b.digits[g]+a.digits[j]*c.digits[k]+d,b.digits[g]=d&65535,d>>>=16;b.digits[k+f+1]=d}b.isNeg=a.isNeg!=c.isNeg;return b};e.biMultiplyDigit=function(a,c){var b,d;result=new l;b=e.biHighIndex(a);for(var f=d=0;f<=b;++f)d=result.digits[f]+a.digits[f]*c+d,result.digits[f]=d&65535,d>>>=16;result.digits[1+b]=d;return result};e.arrayCopy=function(a,c,b,d,e){for(e=Math.min(c+e,a.length);c<e;++c,++d)b[d]=a[c]};var B=[0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535];e.biShiftLeft=function(a,c){var b=Math.floor(c/16),d=new l;e.arrayCopy(a.digits,0,d.digits,b,d.digits.length-b);for(var b=c%16,f=16-b,h=d.digits.length-1,g=h-1;0<h;--h,--g)d.digits[h]=d.digits[h]<<b&65535|(d.digits[g]&B[b])>>>f;d.digits[0]=d.digits[h]<<b&65535;d.isNeg=a.isNeg;return d};var C=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.biShiftRight=function(a,c){var b=Math.floor(c/16),d=new l;e.arrayCopy(a.digits,b,d.digits,0,a.digits.length-b);for(var b=c%16,f=16-b,h=0,g=h+1;h<d.digits.length-1;++h,++g)d.digits[h]=d.digits[h]>>>b|(d.digits[g]&C[b])<<f;d.digits[d.digits.length-1]>>>=b;d.isNeg=a.isNeg;return d};e.biMultiplyByRadixPower=function(a,c){var b=new l;e.arrayCopy(a.digits,0,b.digits,c,b.digits.length-c);return b};e.biDivideByRadixPower=function(a,c){var b=new l;e.arrayCopy(a.digits,c,b.digits,0,b.digits.length-c);return b};e.biModuloByRadixPower=function(a,c){var b=new l;e.arrayCopy(a.digits,0,b.digits,0,c);return b};e.biCompare=function(a,c){if(a.isNeg!=c.isNeg)return 1-2*Number(a.isNeg);for(var b=a.digits.length-1;0<=b;--b)if(a.digits[b]!=c.digits[b])return a.isNeg?1-2*Number(a.digits[b]>c.digits[b]):1-2*Number(a.digits[b]<c.digits[b]);return 0};e.biDivideModulo=function(a,c){var b=e.biNumBits(a),d=e.biNumBits(c),f=c.isNeg,h,g;if(b<d)return a.isNeg?(h=e.biCopy(p),h.isNeg=!c.isNeg,a.isNeg=!1,c.isNeg=!1,g=biSubtract(c,a),a.isNeg=!0,c.isNeg=f):(h=new l,g=e.biCopy(a)),[h,g];h=new l;g=a;for(var k=Math.ceil(d/16)-1,u=0;32768>c.digits[k];)c=e.biShiftLeft(c,1),++u,++d,k=Math.ceil(d/16)-1;g=e.biShiftLeft(g,u);b=Math.ceil((b+u)/16)-1;for(d=e.biMultiplyByRadixPower(c,b-k);-1!=e.biCompare(g,d);)++h.digits[b-k],g=e.biSubtract(g,d);for(;b>k;--b){var d=b>=g.digits.length?0:g.digits[b],m=b-1>=g.digits.length?0:g.digits[b-1],n=b-2>=g.digits.length?0:g.digits[b-2],v=k>=c.digits.length?0:c.digits[k],q=k-1>=c.digits.length?0:c.digits[k-1];h.digits[b-k-1]=d==v?65535:Math.floor((65536*d+m)/v);for(var r=h.digits[b-k-1]*(65536*v+q),t=4294967296*d+(65536*m+n);r>t;)--h.digits[b-k-1],r=h.digits[b-k-1]*(65536*v|q),t=4294967296*d+(65536*m+n);d=e.biMultiplyByRadixPower(c,b-k-1);g=e.biSubtract(g,e.biMultiplyDigit(d,h.digits[b-k-1]));g.isNeg&&(g=e.biAdd(g,d),--h.digits[b-k-1])}g=e.biShiftRight(g,u);h.isNeg=a.isNeg!=f;a.isNeg&&(h=f?e.biAdd(h,p):e.biSubtract(h,p),c=e.biShiftRight(c,u),g=e.biSubtract(c,g));0==g.digits[0]&&0==e.biHighIndex(g)&&(g.isNeg=!1);return[h,g]};e.biDivide=function(a,c){return e.biDivideModulo(a,c)[0]};e.biModulo=function(a,c){return e.biDivideModulo(a,c)[1]};e.biMultiplyMod=function(a,c,b){return e.biModulo(e.biMultiply(a,c),b)};e.biPow=function(a,c){for(var b=p,d=a;;){0!=(c&1)&&(b=e.biMultiply(b,d));c>>=1;if(0==c)break;d=e.biMultiply(d,d)}return b};e.biPowMod=function(a,c,b){for(var d=p;;){0!=(c.digits[0]&1)&&(d=e.biMultiplyMod(d,a,b));c=e.biShiftRight(c,1);if(0==c.digits[0]&&0==e.biHighIndex(c))break;a=e.biMultiplyMod(a,a,b)}return d};m.BarrettMu=function(a){this.modulus=e.biCopy(a);this.k=e.biHighIndex(this.modulus)+1;a=new l;a.digits[2*this.k]=1;this.mu=e.biDivide(a,this.modulus);this.bkplus1=new l;this.bkplus1.digits[this.k+1]=1;this.modulo=w;this.multiplyMod=x;this.powMod=y};var D=function(a,c,b){var d=e;this.e=d.biFromHex(a);this.d=d.biFromHex(c);this.m=d.biFromHex(b);this.chunkSize=2*d.biHighIndex(this.m);this.radix=16;this.barrett=new m.BarrettMu(this.m)};e.getKeyPair=function(a,c,b){return new D(a,c,b)};"undefined"===typeof m.twoDigit&&(m.twoDigit=function(a){return(10>a?"0":"")+String(a)});e.encryptedString=function(a,c){for(var b=[],d=c.length,f=0;f<d;)b[f]=c.charCodeAt(f),f++;for(;0!=b.length%a.chunkSize;)b[f++]=0;for(var d=b.length,h="",g,k,m,f=0;f<d;f+=a.chunkSize){m=new l;g=0;for(k=f;k<f+a.chunkSize;++g)m.digits[g]=b[k++],m.digits[g]+=b[k++]<<8;g=a.barrett.powMod(m,a.e);g=16==a.radix?e.biToHex(g):e.biToString(g,a.radix);h+=g+" "}return h.substring(0,h.length-1)};e.decryptedString=function(a,c){var b=c.split(" "),d="",f,h,g;for(f=0;f<b.length;++f)for(h=16==a.radix?e.biFromHex(b[f]):e.biFromString(b[f],a.radix),g=a.barrett.powMod(h,a.d),h=0;h<=e.biHighIndex(g);++h)d+=String.fromCharCode(g.digits[h]&255,g.digits[h]>>8);0==d.charCodeAt(d.length-1)&&(d=d.substring(0,d.length-1));return d};e.setMaxDigits(130)})(window);